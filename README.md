# 智能家居控制系统

一个基于 Python 的智能家居控制系统，使用面向对象编程实现，支持设备管理、自动化规则、多用户系统和图形界面。

## 项目结构

```
smart_home_project/
├── device.py          # 设备类定义（基础设备及各种子类）
├── user.py            # 用户类定义
├── smart_home.py      # 智能家居系统主类
├── automation.py      # 自动化规则系统
├── logger.py          # 日志记录模块
├── main.py            # 命令行主程序
├── gui.py             # 图形界面程序
├── data.json          # 数据持久化文件
├── automation_rules.json  # 自动化规则描述文件
└── logs.txt           # 日志文件
```

## 核心功能

### 1. 设备管理模块

#### 支持的设备类型

- **Light（智能灯光）**：支持亮度调节（0-100）、色温设置（暖光/冷光）
- **AirConditioner（空调）**：支持温度设置（16-30度）、模式切换（制冷/制热/送风）
- **DoorLock（智能门锁）**：支持上锁/解锁、记录操作时间
- **Camera（摄像头）**：支持旋转角度设置（0-360度）、夜视模式
- **SmartCurtain（智能窗帘）**：支持开合度设置（0-100%）
- **MusicPlayer（音乐播放器）**：支持音量调节、播放模式、歌曲播放
- **MoodLight（情绪灯）**：支持颜色设置、自动随机变换颜色

#### 设备管理功能

- 添加设备：指定设备类型、ID和所有者
- 删除设备：按设备ID删除，自动清理用户关联
- 查看设备：显示所有设备的详细信息（状态、属性、所有者、共享用户）
- 设备控制：开关控制、属性设置

### 2. 用户管理模块

- **添加用户**：创建新用户
- **删除用户**：删除用户及其所有设备
- **查看用户**：列出所有用户及其设备数量
- **用户设备**：查看用户拥有的设备和共享的设备

### 3. 设备控制模块

- **基本控制**：
  - `turn_on()` / `turn_off()`：设备开关控制，避免重复操作
  - 状态反馈：操作后立即显示当前状态

- **属性设置**：
  - 灯光：亮度、色温
  - 空调：温度、模式
  - 门锁：上锁/解锁
  - 摄像头：角度、夜视模式
  - 窗帘：开合度
  - 音乐播放器：音量、播放模式、歌曲
  - 情绪灯：颜色

### 4. 自动化规则模块

#### 规则类型

- **温度条件规则**：
  - 温度 > 30°C → 自动打开空调
  - 温度 < 20°C → 自动关闭空调

- **人员检测规则**：
  - 无人时 → 自动关闭所有灯光

- **安全规则**：
  - 门锁未关闭 → 报警提示

#### 规则管理

- **添加规则**：支持多种预设规则模板
- **查看规则**：列出所有已添加的规则
- **删除规则**：按索引删除规则
- **执行规则**：手动触发或自动检查规则条件

### 5. 日志记录模块

- **详细日志**：记录所有设备操作和系统事件
- **日志内容**：
  - 时间戳
  - 操作类型
  - 用户名（如果有）
  - 设备信息
  - 状态变化
  - 额外信息

- **日志查看**：支持查看最近N条日志记录

### 6. 数据持久化模块

- **保存数据**：将系统状态保存到 `data.json`
  - 用户列表及其设备
  - 设备列表（名称、ID、状态、属性、共享用户）
  
- **加载数据**：系统启动时自动从 `data.json` 加载
  - 恢复用户对象
  - 恢复设备对象
  - 恢复共享关系

- **规则持久化**：保存自动化规则描述（函数无法序列化，需运行时重新添加）

### 7. 设备共享模块

- 设备所有者可以将设备共享给其他用户
- 共享用户可以控制设备（不只是查看）
- 支持查看设备的共享用户列表

## 使用方法

### 命令行版本

运行命令行界面：

```bash
python main.py
```

主菜单功能：
1. 用户管理：添加、删除、查看用户
2. 设备管理：添加、删除、查看设备
3. 设备控制：控制设备开关和属性
4. 设备共享：共享设备给其他用户
5. 自动化规则：添加、查看、删除规则
6. 查看日志：查看最近的操作日志
7. 数据管理：保存/加载数据
8. 运行自动化规则：手动触发规则检查

### 图形界面版本

运行图形界面：

```bash
python gui.py
```

GUI 功能：
- **左侧面板**：
  - 用户列表：选择用户、添加/删除用户
  - 设备列表：显示当前用户的设备（包括共享设备）

- **右侧面板**：
  - 设备详情：显示选中设备的详细信息
  - 设备控制：打开/关闭/共享设备
  - 属性设置：根据设备类型显示相应的控制滑块
  - 自动化规则：添加、删除、查看规则
  - 日志显示：实时显示最近的操作日志

- **顶部工具栏**：
  - 保存数据
  - 运行自动化规则
  - 刷新所有显示

## 类结构说明

### Device（设备基类）

所有设备的基类，提供：
- 基本属性：name, device_id, status, attributes, shared_users
- 基本方法：turn_on(), turn_off(), set_attr(), share()

### 设备子类

- `Light`：智能灯光
- `AirConditioner`：空调
- `DoorLock`：智能门锁
- `Camera`：摄像头
- `SmartCurtain`：智能窗帘
- `MusicPlayer`：音乐播放器
- `MoodLight`：情绪灯

### User（用户类）

- 属性：username, devices（设备ID列表）
- 方法：add_device(), remove_device()

### SmartHome（系统主类）

- 维护所有用户和设备
- 提供设备管理、用户管理、设备控制、数据持久化等功能

### AutomationRule（自动化规则类）

- 属性：condition（条件函数）、action（动作函数）、description（描述）
- 方法：check()（检查条件）、execute()（执行动作）

### AutomationManager（自动化管理器）

- 维护规则列表
- 提供添加、删除、执行规则的方法

### Logger（日志记录类）

- 记录所有操作到日志文件
- 支持详细的日志信息（用户、设备、状态变化等）

## 创新点

1. **丰富的设备类型**：实现了7种不同类型的智能设备，每种设备都有独特的属性和控制方法

2. **完善的自动化规则系统**：
   - 支持基于传感器数据的条件判断
   - 支持多种预设规则模板
   - 规则可以动态添加和删除

3. **友好的图形界面**：
   - 使用 tkinter 实现简洁美观的GUI
   - 支持实时设备状态显示
   - 提供直观的设备控制界面
   - 集成日志查看和自动化规则管理

4. **完善的日志系统**：
   - 详细记录所有操作
   - 支持查看最近日志
   - 便于系统审计和问题排查

5. **数据持久化**：
   - 自动保存和加载系统状态
   - 支持规则描述持久化

## 技术特点

- **面向对象设计**：使用类和继承实现代码复用
- **基础 Python 语法**：适合教学，易于理解
- **清晰的代码结构**：模块化设计，职责分明
- **中文注释**：便于理解和维护

## 注意事项

1. 自动化规则中的函数无法直接序列化到JSON，因此规则描述会保存，但规则函数需要在运行时重新添加

2. 传感器数据（温度、是否有人等）在示例中是模拟的，实际应用中可以连接真实传感器

3. 数据文件（data.json, logs.txt）会在程序运行时自动创建

## 实验报告要点

### 四个考察点的实现

1. **设备管理+自动化**：
   - 设备管理：完整的增删查改功能
   - 自动化：基于条件的规则触发系统

2. **日志**：
   - Logger 类实现详细的日志记录
   - 所有操作都有日志记录

3. **持久化**：
   - JSON 格式保存系统状态
   - 启动时自动加载

### 设计思路

- **继承**：设备类使用继承实现代码复用
- **组合**：SmartHome 组合 User、Device、AutomationManager
- **封装**：每个类封装自己的数据和操作
- **多态**：不同设备类型有不同的控制方法

## 作者

本项目为 Python 实验三：模拟智能家居控制系统

## 许可证

本项目仅用于教学和学习目的。

